# 1장. 스프링 개발 환경 구축
## ch03. 스프링과 Oracle Database 연동
- ojdbc8.jar 빌드패스 추가 (java 1.8 버젼은 ojdbc8 사용)
- JDBC 테스트 코드
    - JDBCTests.java
    ```java
    package org.zerock.persistence;

    import static org.junit.Assert.fail;

    import java.sql.Connection;
    import java.sql.DriverManager;

    import org.junit.Test;

    import lombok.extern.log4j.Log4j;

    @Log4j
    public class JDBCTests {
        static {
            try {
                Class.forName("oracle.jdbc.driver.OracleDriver");
            } catch(Exception e) {
                e.printStackTrace();
            }
        }

        @Test
        public void testConnection() {
            try(Connection con = DriverManager.getConnection("jdbc:oracle:thin:@tongracle.cnsqtfo00xiq.ap-northeast-2.rds.amazonaws.com:1521:orcl","book_ex","book_ex")) {
                log.info(con);
            }catch(Exception e) {
                fail(e.getMessage());
            }
        }
    }
    ```
- 커넥션 풀 설정
    - 일반적으로 여러 명의 사용자가 동시에 처리해야 하는 웹 어플리케이션의 경우 데이터베이스 연결을 이용할 때는 <strong>커넥션 풀(Connection Pool)</strong>을 이용하므로, 스프링에 등록 권장
    - Java에서는 DataSource 인터페이스를 통해 커넥션 풀을 사용함
    - DataSource : 매번 데이터베이스와 연결하는 방식이 아닌, 미리 연결을 맺어주고 반환하는 구조(성능 향상)
    - 현재 예제는 HikariCP 라이브러리 사용 (다른 라이브러리로는 spring-jdbc등이 있음)
- pom.xml
    ```xml
    <dependency>
        <groupId>com.zaxxer</groupId>
        <artifactId>HikariCP</artifactId>	<!-- DataSource 라이브러리 -->
        <version>2.7.4</version>
    </dependency>
    ```

- root-context.xml
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd">
        
        <!-- Root Context: defines shared resources visible to all other web components -->
        <!-- <bean id="hikariConfig" class="com.zaxxer.hikari.HikariConfig">
            <property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"></property>
            <property name="jdbcUrl" value="jdbc:oracle:thin:@tongracle.cnsqtfo00xiq.ap-northeast-2.rds.amazonaws.com:1521:orcl"></property>
            <property name="username" value="book_ex"></property>
            <property name="password" value="book_ex"></property>
        </bean> -->
        
        <!-- HikariCP configuration -->
        <!-- <bean id="dataSource" class="com.zaxxer.hikari.HikariDataSource" destroy-method="close">
            <constructor-arg ref="hikariConfig" />
        </bean> -->
        
        <!-- HikariCP configuration 
             책 예제를 따라하니 에러발생해서 변경함-->
        <bean id="dataSource" class="com.zaxxer.hikari.HikariDataSource" destroy-method="close">
            <property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"></property>
            <property name="jdbcUrl" value="jdbc:oracle:thin:@tongracle.cnsqtfo00xiq.ap-northeast-2.rds.amazonaws.com:1521:orcl"></property>
            <property name="username" value="book_ex"></property>
            <property name="password" value="book_ex"></property>
        </bean>
        
        <context:component-scan base-package="org.zerock.sample"></context:component-scan>
            
    </beans>
    ```

- RootConfig.java   (자바설정 버젼)
    ```java
    package org.zerock.config;

    import org.springframework.context.annotation.Configuration;
    import org.springframework.context.annotation.ComponentScan;

    import javax.sql.DataSource;

    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.ComponentScan;
    import org.springframework.context.annotation.Configuration;

    import com.zaxxer.hikari.HikariConfig;
    import com.zaxxer.hikari.HikariDataSource;

    @Configuration
    @ComponentScan(basePackages= {"org.zerock.sample"})
    public class RootConfig {
        @Bean
        public DataSource dataSource() {
            HikariConfig hikariConfig = new HikariConfig();
    //	    hikariConfig.setDriverClassName("oracle.jdbc.driver.OracleDriver");
    //	    hikariConfig.setJdbcUrl("jdbc:oracle:thin:@localhost:1521:XE");

            hikariConfig.setDriverClassName("oracle.jdbc.driver.OracleDriver");
            hikariConfig.setJdbcUrl("jdbc:oracle:thin:@tongracle.cnsqtfo00xiq.ap-northeast-2.rds.amazonaws.com:1521:orcl");

            hikariConfig.setUsername("book_ex");
            hikariConfig.setPassword("book_ex");

            HikariDataSource dataSource = new HikariDataSource(hikariConfig);

            return dataSource;
        }
    }
    ```

- DataSourceTests.java
    ```java
    package org.zerock.persistence;

    import static org.junit.Assert.fail;

    import java.sql.Connection;

    import javax.sql.DataSource;

    import org.junit.Test;
    import org.junit.runner.RunWith;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.test.context.ContextConfiguration;
    import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

    import lombok.Setter;
    import lombok.extern.log4j.Log4j;

    @RunWith(SpringJUnit4ClassRunner.class)
    @ContextConfiguration("file:src/main/webapp/WEB-INF/spring/root-context.xml")
    /*
    * JAVA 설정을 사용하는 경우
    * @ContextConfiguration(class = {RootConfig.class})
    */
    @Log4j
    public class DataSourceTests {
        @Setter(onMethod_= {@Autowired})
        private DataSource dataSource;
        
        @Test
        public void testConnection() {
            try(Connection con = dataSource.getConnection()){
                log.info(con);
            }catch(Exception e) {
                fail(e.getMessage());
            }
        }
    }
    ```